# è‡ªåŠ¨æ„å»ºä¸å‘å¸ƒæµç¨‹
# æ­¤å·¥ä½œæµç¨‹æ”¯æŒä¸‰ç§è§¦å‘æ–¹å¼ï¼š
# 1. push åˆ° main åˆ†æ”¯ï¼šä»…æ‰§è¡Œä»£ç æ£€æŸ¥å’Œæ„å»ºæµ‹è¯•ï¼Œä¸æ¨é€æ ‡ç­¾ã€Docker é•œåƒæˆ–åˆ›å»ºå‘å¸ƒï¼›
# 2. pull_request åˆ° main åˆ†æ”¯ï¼šä»…æ‰§è¡Œä»£ç æ£€æŸ¥å’Œæ„å»ºæµ‹è¯•ï¼Œä¸æ¨é€æ ‡ç­¾ã€Docker é•œåƒæˆ–åˆ›å»ºå‘å¸ƒï¼›
# 3. workflow_dispatchï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰ï¼šæ‰§è¡Œç‰ˆæœ¬å·é€’å¢ã€æ ‡ç­¾æ¨é€ã€Docker é•œåƒæ„å»ºä¸æ¨é€ä»¥åŠåˆ›å»ºå‘å¸ƒï¼Œ
#    æ ¹æ®è¾“å…¥å‚æ•°å†³å®šæ„å»ºé¢„å‘å¸ƒï¼ˆbetaï¼‰æˆ–æ­£å¼å‘å¸ƒï¼ˆreleaseï¼‰ã€‚
name: è‡ªåŠ¨æ„å»ºä¸å‘å¸ƒæµç¨‹

# å®šä¹‰è§¦å‘æ¡ä»¶
on:
  # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘ï¼Œä½†å¿½ç•¥éƒ¨åˆ†æ–‡ä»¶çš„å˜æ›´
  push:
    branches: [ main ]
    paths-ignore:
      - '*.md'                    # å¿½ç•¥æ‰€æœ‰ markdown æ–‡ä»¶
      - 'docs/**'                 # å¿½ç•¥æ–‡æ¡£ç›®å½•
      - '.github/*.md'            # å¿½ç•¥ GitHub ç›¸å…³æ–‡æ¡£
      - 'LICENSE'                 # å¿½ç•¥è®¸å¯è¯æ–‡ä»¶
      - '.gitignore'              # å¿½ç•¥ Git å¿½ç•¥æ–‡ä»¶
      - '.editorconfig'           # å¿½ç•¥ç¼–è¾‘å™¨é…ç½®
  # å½“é’ˆå¯¹ main åˆ†æ”¯å‘èµ· PR æ—¶è§¦å‘
  pull_request:
    branches: [ main ]
    paths-ignore:
      - '*.md'
      - 'docs/**'
      - '.github/*.md'
      - 'LICENSE'
      - '.gitignore'
      - '.editorconfig'
  # æ‰‹åŠ¨è§¦å‘å·¥ä½œæµç¨‹
  workflow_dispatch:
    inputs:
      release_type:
        description: 'å‘å¸ƒç±»å‹ (beta=é¢„å‘å¸ƒ, release=æ­£å¼å‘å¸ƒ)'
        required: true
        default: 'beta'
        type: choice
        options:
          - beta     # é¢„å‘å¸ƒç‰ˆæœ¬
          - release  # æ­£å¼å‘å¸ƒç‰ˆæœ¬

# é…ç½®å…¨å±€æƒé™
permissions:
  contents: write   # å…è®¸åˆ›å»ºå‘å¸ƒå’Œæ¨é€æ ‡ç­¾
  packages: write   # å…è®¸æ¨é€åˆ° GitHub Packages

# å…¨å±€ç¯å¢ƒå˜é‡è®¾ç½®
env:
  GO_VERSION: '1.22.0'             # ä½¿ç”¨çš„ Go ç‰ˆæœ¬
  BINARY_NAME: 'HubP'              # é¡¹ç›®ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶åç§°
  DOCKER_IMAGE: 'hubp'             # Docker é•œåƒåç§°
  PLATFORMS: linux/amd64,linux/arm64  # Docker æ„å»ºæ”¯æŒçš„å¹³å°
  CGO_ENABLED: 0                   # ç¦ç”¨ CGOï¼Œä½¿ç”¨çº¯ Go å®ç°

jobs:
  # ç‰ˆæœ¬æ§åˆ¶ä»»åŠ¡
  # ç”¨äºè·å–æœ€æ–° Git æ ‡ç­¾ï¼Œå¹¶åœ¨æ‰‹åŠ¨è§¦å‘æ—¶å¯¹ç‰ˆæœ¬å·é€’å¢ã€åˆ›å»ºå¹¶æ¨é€æ–°æ ‡ç­¾
  version:
    runs-on: ubuntu-latest
    outputs:
      # å°†æ–°ç‰ˆæœ¬å·è¾“å‡ºä¾›å…¶ä»–ä»»åŠ¡ä½¿ç”¨
      new_version: ${{ steps.bump_version.outputs.new_version }}
      # æ ‡è¯†æ˜¯å¦ä¸ºæ‰‹åŠ¨è§¦å‘ï¼ˆworkflow_dispatchï¼‰
      is_manual_release: ${{ github.event_name == 'workflow_dispatch' }}
      # æ ‡è¯†æ˜¯å¦ä¸ºæ­£å¼å‘å¸ƒï¼ˆæ‰‹åŠ¨è§¦å‘ä¸” release_type ä¸º releaseï¼‰
      is_release: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.release_type == 'release' }}
    steps:
      - name: æ£€å‡ºä»£ç  ğŸ“¥
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # è·å–å®Œæ•´æäº¤å†å²ï¼Œç”¨äºæ­£ç¡®è·å–æœ€æ–°æ ‡ç­¾

      - name: è·å–æœ€æ–°ç‰ˆæœ¬æ ‡ç­¾ ğŸ·ï¸
        id: get_latest
        run: |
          # å°è¯•è·å–æœ€è¿‘çš„ Git æ ‡ç­¾ï¼Œå¦‚æ— åˆ™é»˜è®¤ v0.0.0
          latest_tag=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
          echo "æœ€æ–°æ ‡ç­¾: ${latest_tag}"
          echo "latest_tag=${latest_tag}" >> $GITHUB_OUTPUT

      - name: ç”Ÿæˆæ–°ç‰ˆæœ¬å·æˆ–ä½¿ç”¨ç°æœ‰ç‰ˆæœ¬å· ğŸ“
        id: bump_version
        shell: bash
        run: |
          # ä»ä¸Šä¸€æ­¥è·å–æœ€æ–°æ ‡ç­¾
          latest_tag="${{ steps.get_latest.outputs.latest_tag }}"
          echo "å½“å‰è·å–çš„æ ‡ç­¾ä¸º: ${latest_tag}"
          # å¦‚æœä¸ºæ‰‹åŠ¨è§¦å‘ï¼Œåˆ™å¯¹ç‰ˆæœ¬å·è¿›è¡Œé€’å¢ï¼ˆä»…é€’å¢ä¿®è®¢å·ï¼‰
          if [ "$GITHUB_EVENT_NAME" == "workflow_dispatch" ]; then
            version="${latest_tag#v}"  # å»é™¤ v å‰ç¼€
            # å°†ç‰ˆæœ¬å·æŒ‰ . åˆ†å‰²ä¸ºä¸»ç‰ˆæœ¬ã€æ¬¡ç‰ˆæœ¬å’Œä¿®è®¢å·
            IFS='.' read -r major minor patch <<< "$version"
            patch=${patch:-0}  # è‹¥ patch ä¸ºç©ºåˆ™é»˜è®¤ 0
            patch=$((patch + 1))
            new_version="v${major}.${minor}.${patch}"
            echo "æ‰‹åŠ¨è§¦å‘ï¼šç”Ÿæˆæ–°ç‰ˆæœ¬å·: ${new_version}"
          else
            # éæ‰‹åŠ¨è§¦å‘æ—¶ç›´æ¥ä½¿ç”¨è·å–çš„æœ€æ–°æ ‡ç­¾
            new_version="${latest_tag}"
            echo "éæ‰‹åŠ¨è§¦å‘ï¼šä½¿ç”¨ç°æœ‰ç‰ˆæœ¬å·: ${new_version}"
          fi
          echo "new_version=${new_version}" >> $GITHUB_OUTPUT

      - name: æ‰‹åŠ¨è§¦å‘æ—¶åˆ›å»ºå¹¶æ¨é€æ–°æ ‡ç­¾ ğŸ“Œ
        if: ${{ github.event_name == 'workflow_dispatch' }}
        run: |
          echo "é…ç½® Git ç”¨æˆ·ä¿¡æ¯..."
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          echo "åˆ›å»ºæ ‡ç­¾: ${{ steps.bump_version.outputs.new_version }}"
          git tag -a ${{ steps.bump_version.outputs.new_version }} -m "Release ${{ steps.bump_version.outputs.new_version }}"
          echo "æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“..."
          git push origin ${{ steps.bump_version.outputs.new_version }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ä»£ç è´¨é‡æ£€æŸ¥ä»»åŠ¡
  # è´Ÿè´£ä»£ç æ ¼å¼åŒ–ã€é™æ€æ£€æŸ¥ä»¥åŠéªŒè¯é¡¹ç›®å¿…è¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç  ğŸ“¥
        uses: actions/checkout@v4

      - name: è®¾ç½® Go ç¯å¢ƒ ğŸ”§
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      - name: ä»£ç æ ¼å¼åŒ–ä¸é™æ€æ£€æŸ¥ ğŸ”
        run: |
          if [ -f go.mod ]; then
            echo "æ‰§è¡Œ go fmt æ ¼å¼åŒ–ä»£ç ..."
            go fmt ./...
            echo "æ‰§è¡Œ go vet è¿›è¡Œé™æ€æ£€æŸ¥..."
            go vet ./...
          else
            echo "è­¦å‘Šï¼šæœªæ‰¾åˆ° go.mod æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥é¡¹ç›®ç»“æ„ï¼"
            exit 1
          fi

      - name: æ£€æŸ¥é¡¹ç›®å¿…è¦æ–‡ä»¶ ğŸ“‚
        run: |
          # éªŒè¯ main.go æ˜¯å¦å­˜åœ¨
          if [ ! -f "main.go" ]; then
            echo "é”™è¯¯ï¼šæœªæ‰¾åˆ° main.go æ–‡ä»¶ï¼Œè¯·ç¡®ä¿å­˜åœ¨ main.go ä½œä¸ºé¡¹ç›®å…¥å£ï¼"
            exit 1
          fi
          # éªŒè¯ Dockerfile æ˜¯å¦å­˜åœ¨
          if [ ! -f "Dockerfile" ]; then
            echo "é”™è¯¯ï¼šæœªæ‰¾åˆ° Dockerfile æ–‡ä»¶ï¼Œè¯·ç¡®ä¿å­˜åœ¨ç”¨äºæ„å»ºé•œåƒçš„ Dockerfileï¼"
            exit 1
          fi

  # å¤šå¹³å°æ„å»ºä»»åŠ¡
  # è´Ÿè´£ç¼–è¯‘é¡¹ç›®ã€æ‰“åŒ…æ„å»ºäº§ç‰©å¹¶ç”Ÿæˆæ ¡éªŒå’Œï¼ˆç”¨äºæµ‹è¯•éªŒè¯ï¼‰
  build:
    needs: [version, lint]  # ä¾èµ–ç‰ˆæœ¬æ§åˆ¶å’Œä»£ç æ£€æŸ¥ä»»åŠ¡
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false   # æŸä¸ªå¹³å°æ„å»ºå¤±è´¥ä¸å½±å“å…¶ä»–å¹³å°
      matrix:
        # å®šä¹‰ç›®æ ‡æ“ä½œç³»ç»Ÿå’Œæ¶æ„ç»„åˆ
        os: [linux, darwin, windows, freebsd]
        arch: [amd64, arm64]
    steps:
      - name: æ£€å‡ºä»£ç  ğŸ“¥
        uses: actions/checkout@v4

      - name: è®¾ç½® Go ç¯å¢ƒ ğŸ”§
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      - name: æ•´ç† Go æ¨¡å—ä¾èµ– ğŸ“¦
        run: |
          echo "æ•´ç†æ¨¡å—ä¾èµ–..."
          go mod tidy
          echo "ä¸‹è½½æ‰€æœ‰ä¾èµ–åŒ…..."
          go mod download

      - name: ç¼–è¯‘é¡¹ç›®å¹¶æ‰“åŒ…æ„å»ºäº§ç‰© ğŸ—ï¸
        run: |
          # è·å–ç‰ˆæœ¬å·ï¼Œè‹¥ä¸ºç©ºåˆ™æŠ¥é”™
          VERSION=${{ needs.version.outputs.new_version }}
          if [ -z "$VERSION" ]; then
            echo "é”™è¯¯ï¼šæœªè·å–åˆ°ç‰ˆæœ¬å·ï¼"
            exit 1
          fi
          echo "æ„å»ºç‰ˆæœ¬: ${VERSION}"
          
          # æ ¹æ®ç›®æ ‡æ“ä½œç³»ç»Ÿè®¾ç½®äºŒè¿›åˆ¶æ–‡ä»¶åç§°ï¼ˆWindows éœ€è¦ .exe åç¼€ï¼‰
          binary_name="${{ env.BINARY_NAME }}"
          if [ "${{ matrix.os }}" = "windows" ]; then
            binary_name="${binary_name}.exe"
          fi
          
          # åˆ›å»ºå­˜æ”¾æ„å»ºäº§ç‰©çš„ç›®å½•
          output_dir="release/${{ env.BINARY_NAME }}-${VERSION}-${{ matrix.os }}-${{ matrix.arch }}"
          mkdir -p "${output_dir}"
          
          echo "å¼€å§‹ç¼–è¯‘ï¼šæ“ä½œç³»ç»Ÿ=${{ matrix.os }}, æ¶æ„=${{ matrix.arch }}"
          # è®¾ç½®ç¯å¢ƒå˜é‡è¿›è¡Œç¼–è¯‘ï¼ŒåŒæ—¶åµŒå…¥ç‰ˆæœ¬ä¿¡æ¯åˆ°äºŒè¿›åˆ¶ä¸­
          GOOS=${{ matrix.os }} GOARCH=${{ matrix.arch }} \
          go build -trimpath \
            -ldflags="-s -w -X main.Version=${VERSION}" \
            -o "${output_dir}/${binary_name}" .
          
          # åˆ‡æ¢åˆ° release ç›®å½•ï¼Œæ‰“åŒ…ç”Ÿæˆ zip æ–‡ä»¶
          cd release
          zip_file="${{ env.BINARY_NAME }}-${VERSION}-${{ matrix.os }}-${{ matrix.arch }}.zip"
          echo "åˆ›å»ºå‹ç¼©åŒ…: ${zip_file}"
          zip -9 "${zip_file}" -r "$(basename ${output_dir})"/*
          
          # ç”Ÿæˆè¯¥å¹³å°å¯¹åº”çš„æ ¡éªŒå’Œæ–‡ä»¶
          echo "ç”Ÿæˆæ ¡éªŒå’Œ..."
          sha256sum "${zip_file}" | tee -a "checksums-${{ matrix.os }}-${{ matrix.arch }}.txt"
          
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©ä½œä¸ºæ„å»ºç»“æœ ğŸ“¤
        uses: actions/upload-artifact@v4
        with:
          name: release-${{ matrix.os }}-${{ matrix.arch }}
          path: release/*
          retention-days: 1

  # Docker æ„å»ºä»»åŠ¡ï¼ˆä»…åœ¨æ‰‹åŠ¨è§¦å‘æ—¶æ‰§è¡Œï¼‰
  # æ ¹æ®å‘å¸ƒç±»å‹æ„å»ºå¹¶æ¨é€å¯¹åº”çš„ Docker é•œåƒï¼š
  # - Beta ç‰ˆæœ¬ï¼ˆé¢„å‘å¸ƒï¼‰ï¼šæ¨é€å¸¦æœ‰ç‰ˆæœ¬å·å’Œ beta æ ‡ç­¾ï¼›
  # - æ­£å¼ç‰ˆæœ¬ï¼šæ¨é€å¸¦æœ‰ç‰ˆæœ¬å·å’Œ latest æ ‡ç­¾ã€‚
  docker:
    needs: [version, lint]
    if: ${{ github.event_name == 'workflow_dispatch' }}  # ä»…æ‰‹åŠ¨è§¦å‘æ—¶æ‰§è¡Œ Docker æ„å»ºä¸æ¨é€
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç  ğŸ“¥
        uses: actions/checkout@v4

      - name: è®¾ç½® QEMU æ¨¡æ‹Ÿç¯å¢ƒ ğŸ³
        uses: docker/setup-qemu-action@v3

      - name: è®¾ç½® Docker Buildx ç¯å¢ƒ ğŸ› ï¸
        uses: docker/setup-buildx-action@v3

      - name: ç™»å½• Docker Hub ğŸ”‘
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # æ„å»ºå¹¶æ¨é€ Beta ç‰ˆæœ¬é•œåƒï¼ˆé¢„å‘å¸ƒç‰ˆæœ¬ï¼‰
      - name: æ„å»ºå¹¶æ¨é€ Beta ç‰ˆæœ¬é•œåƒ ğŸš§
        if: ${{ needs.version.outputs.is_release != 'true' }}
        uses: docker/build-push-action@v5
        with:
          context: .
          platforms: ${{ env.PLATFORMS }}
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:${{ needs.version.outputs.new_version }}
            ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:beta
          # æ„å»ºå‚æ•°ä¼ å…¥ç‰ˆæœ¬å·å’Œ Go ç‰ˆæœ¬
          build-args: |
            VERSION=${{ needs.version.outputs.new_version }}
            GO_VERSION=${{ env.GO_VERSION }}

      # æ„å»ºå¹¶æ¨é€æ­£å¼ç‰ˆæœ¬é•œåƒï¼ˆrelease ç‰ˆæœ¬ï¼‰
      - name: æ„å»ºå¹¶æ¨é€æ­£å¼ç‰ˆæœ¬é•œåƒ ğŸš€
        if: ${{ needs.version.outputs.is_release == 'true' }}
        uses: docker/build-push-action@v5
        with:
          context: .
          platforms: ${{ env.PLATFORMS }}
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:${{ needs.version.outputs.new_version }}
            ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:latest
          build-args: |
            VERSION=${{ needs.version.outputs.new_version }}
            GO_VERSION=${{ env.GO_VERSION }}

  # GitHub å‘å¸ƒä»»åŠ¡ï¼ˆä»…åœ¨æ‰‹åŠ¨è§¦å‘æ—¶æ‰§è¡Œï¼‰
  # ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©ï¼Œæ•´åˆæ ¡éªŒå’Œï¼Œå¹¶ç”Ÿæˆå‘å¸ƒè¯´æ˜ååˆ›å»º GitHub å‘å¸ƒ
  release:
    needs: [version, build, docker]
    if: ${{ github.event_name == 'workflow_dispatch' }}  # ä»…æ‰‹åŠ¨è§¦å‘æ—¶åˆ›å»ºå‘å¸ƒ
    runs-on: ubuntu-latest
    steps:
      - name: ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰© ğŸ“¥
        uses: actions/download-artifact@v4
        with:
          path: release
          pattern: release-*
          merge-multiple: true

      - name: å‡†å¤‡å‘å¸ƒæ–‡ä»¶å’Œç”Ÿæˆå‘å¸ƒè¯´æ˜ ğŸ“‹
        run: |
          mkdir -p final_release
          echo "å¤åˆ¶æ‰€æœ‰å‹ç¼©åŒ…åˆ° final_release ç›®å½•..."
          find release -name "*.zip" -exec cp {} final_release/ \;
          
          echo "æ•´åˆå„å¹³å°çš„æ ¡éªŒå’Œåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­..."
          echo "## SHA256 æ ¡éªŒå’Œ" > final_release/checksums.txt
          find release -name "checksums-*.txt" -exec cat {} >> final_release/checksums.txt \;
          
          # æ ¹æ®æ˜¯å¦ä¸ºæ­£å¼å‘å¸ƒç”Ÿæˆä¸åŒçš„å‘å¸ƒè¯´æ˜
          {
            if [ "${{ needs.version.outputs.is_release }}" = "true" ]; then
              echo "# ğŸš€ æ­£å¼å‘å¸ƒç‰ˆæœ¬ ${{ needs.version.outputs.new_version }}"
              echo ""
            else
              echo "# ğŸš§ é¢„å‘å¸ƒç‰ˆæœ¬ ${{ needs.version.outputs.new_version }}"
              echo ""
            fi
            echo "## ğŸ“¦ æ”¯æŒçš„å¹³å°"
            echo "- Linux (AMD64, ARM64)"
            echo "- macOS (AMD64, ARM64)"
            echo "- Windows (AMD64, ARM64)"
            echo "- FreeBSD (AMD64, ARM64)"
            echo ""
            echo "## ğŸ³ Docker é•œåƒè¯´æ˜"
            echo "æ”¯æŒçš„æ¶æ„ï¼šAMD64, ARM64"
            echo ""
            echo "### é•œåƒè·å–æ–¹å¼"
            if [ "${{ needs.version.outputs.is_release }}" = "true" ]; then
              echo "- ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ: docker pull ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:latest"
              echo "- ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬: docker pull ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:${{ needs.version.outputs.new_version }}"
            else
              echo "- ä½¿ç”¨æœ€æ–°æµ‹è¯•ç‰ˆ: docker pull ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:beta"
              echo "- ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬: docker pull ${{ secrets.DOCKER_USERNAME }}/${{ env.DOCKER_IMAGE }}:${{ needs.version.outputs.new_version }}"
            fi
            echo ""
            echo "## æ ¡éªŒå’Œæ–‡ä»¶"
            cat final_release/checksums.txt
          } > final_release/release_notes.md

      - name: åˆ›å»º GitHub å‘å¸ƒç‰ˆæœ¬ ğŸ“¢
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ needs.version.outputs.new_version }}
          files: |
            final_release/*.zip
            final_release/checksums.txt
          body_path: final_release/release_notes.md
          draft: false
          # å¦‚æœä¸æ˜¯æ­£å¼å‘å¸ƒåˆ™æ ‡è®°ä¸ºé¢„å‘å¸ƒ
          prerelease: ${{ needs.version.outputs.is_release != 'true' }}
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
